# 👨‍💻 NAT(_Network Address Translation_)
* IP 패킷의 TCP/UDP 포트 숫자와 소스 및 목적지의 IP 주소 등을 재기록하면서 라우터를 통해 네트워크 트래픽을 주고 받는 기술을 말한다.

* 패킷에 변화가 생기기 때문에 IP나 TCP/UDP의 체크섬(checksum)도 다시 계산되어 재기록해야 한다.

* NAT를 이용하는 이유는 대개 사설 네트워크에 속한 여러 개의 호스트가 하나의 공인 IP 주소를 사용하여 인터넷에 접속하기 위함이다.

      외부에 공개된 공인 IP와 내부에서 사용하는 사설 IP가 다른 경우 네트워크 전송수행 시 두 IP주소를 매핑하여 원활히 운영할 수 있게 한다.

* 공인 IP를 전체 사용자에게 할당하지 않아도 되기 때문에 IP주소 부족 문제를 해결할 수 있다.

* NAT는 전체 네트워크에 대해 하나의 주소만 외부 세계에 알리도록 구성할 수 있다.

      전체 내부 네트워크를 해당 주소 뒤에 효과적으로 숨겨 보안을 강화할 수 있다.   
      NAT는 보안과 주소 보존의 이중 기능을 제공하며 일반적으로 원격 액세스 환경에서 구현된다.

* NAT는 라우터에서 작동하며, 일반적으로 두 개의 네트워크를 함께 연결하고, 패킷이 다른 네트워크로 전달되기 전에 내부 네트워크의 사설(전역적으로 고유하지 않음) 주소를 법적 주소로 변환한다.

<img src="https://user-images.githubusercontent.com/62328584/107299232-39bbc380-6aba-11eb-850c-897e48768582.JPG" width="700px" height="500px"></img><br/>


### **< NAT 동작원리  >**
<img src="https://user-images.githubusercontent.com/62328584/107305167-cb7cfe00-6ac5-11eb-9732-9407bc8e88f6.JPG" width="700px" height="500px"></img><br/>

1. 패킷 헤더에 출발지와 목적지 주소를 기록한다. 출발지는 자신의 사설 IP주소를 기록.

      Host에서 출발   
      ▶출발지 IP주소: 10.0.0.1   
      ▶목적지 IP주소: 200.100.10.1

2. 게이트웨이에서는 외부로 나가는 패킷을 인식하게 되면 출발지의 IP주소를 게이트웨이 자신의 공인 IP주소로 변경한다. NAT 테이블에 기록

      게이트웨이에서 출발   
      ▶출발지 IP주소: 10.0.0.1 => 150.150.0.1   
      ▶목적지 IP주소: 200.100.10.1

3. 서버는 수신한 데이터를 처리한 후, 응답할 때 보내는 패킷에 출발지와 목적지의 IP주소를 기록하여 보낸다. 이때 목적지 IP주소는 호스트의 게이트웨이 공인 IP주소가 된다.

      서버에서 출발   
      ▶출발지 IP주소: 200.100.10.1   
      ▶목적지 IP주소: 150.150.0.1

4. 게이트웨이는 서버가 보낸 패킷을 받으면 기록해두었던 NAT 테이블을 참조하여 최종 목적지인 호스트의 사설 IP주소로 변경하여 해당 호스트로 패킷을 전달한다.

      게이트웨이에서 출발   
      ▶출발지 IP주소: 200.100.10.1   
      ▶목적지 IP주소: 150.150.0.1 => 10.0.0.1



### **< 주소 할당 방식에 따른 NAT 종류  >**

**Static NAT**: 공인 IP주소와 내부 IP주소가 일대일로 매칭.

<img src="https://user-images.githubusercontent.com/62328584/107299542-03cb0f00-6abb-11eb-9bdb-8a49a7f11eca.JPG" width="600px" height="350px"></img><br/>

▶구성 특성상 공인 IP주소의 절약 효과는 없음   
-주로 사설 IP주소를 사용하는 서버가 여러 가지 역할을 할 때 포트포워딩을 목적으로 사용.

      #포트포워딩(Port forwarding): 하나의 서버에 여러 서비스를 운영 중인 경우, 특정 서비스에 임의의 포트를 지정하여 해당 포트를 통해 특정 서비스의 경로를 지정해주는 기능

-Static NAT에서는 IP가 일대일로 매칭되어 있기 때문에 특정 공인 IP로 들어오는 것을 사설 IP에 연결 해줄 수 있다.

**PAT(Port Address Translation), NAPT(Network Address Port Translation_1 : N)**: 1개의 공인 IP주소에 여러 개의 사설 IP주소가 매칭되는 방식

<img src="https://user-images.githubusercontent.com/62328584/107315962-0f2e3280-6adb-11eb-926b-4c8fc6577ee3.JPG" width="600px" height="450px"></img><br/>

▶사설 네트워크 내 각 호스트에 임의의 포트번호를 지정하여 사설 IP와 해당 포트번호를 공인 IP주소와 매칭.

      호스트마다 포트번호를 지정했기 때문에 외부에서 들어오는 패킷을 올바른 목적지로 전달할 수 있다.

-1개의 공인 IP를 여러 개의 사설 IP가 사용하고 있기 때문에 내부에서 외부로 나가는 통신이 아닌, 외부에서 공인IP로 통신을 시도하였을 때 중간에서 NAT를 시켜주는 Firewall와 같은 장비에서 어느 사설 IP에게 전달해주어야 할지 알 수가 없다. 그래서 PAT의 경우는 외부에서 내부로 먼저 통신을 시도 할 수가 없다.

**Dynamic NAT**: 여러 개의 공인 IP와 여러 개의 사설 IP를 매핑

▶현재 사용중이지 않은 공인 IP에 사설 IP를 동적으로 매핑한다.   
▶보통 공인 IP가 사설 IP보다 적을 경우 사용.

      공인 IP를 효율적으로 사용가능.
